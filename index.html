<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Study Search • Premium</title>
<style>
:root{
  --bg:#f8fafc; --fg:#0f172a; --muted:#64748b; --panel:rgba(255,255,255,.85); --panel-solid:#ffffff; --border:#e2e8f0;
  --accent:#1a73e8; --accent-ghost:rgba(26,115,232,.16); --shadow:0 12px 40px rgba(2,6,23,.08);
  --chip:#eef2ff; --chip-fg:#0f172a; --glass-blur:10px;
}
html[data-theme="dark"]{
  --bg:linear-gradient(160deg,#0e141b 0%, #0f172a 45%, #1a2230 100%);
  --fg:#e5e7eb; --muted:#9aa4b2; --panel:rgba(27,36,50,.6); --panel-solid:#1b2432; --border:#2b374a;
  --accent:#39ff14; --accent-ghost:rgba(57,255,20,.18); --shadow:0 18px 54px rgba(0,0,0,.55);
  --chip:#1f2a3b; --chip-fg:#e5e7eb; --glass-blur:14px;
}

/* Base */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:var(--bg); color:var(--fg); min-height:100%;
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
}
.wrapper{min-height:100%;display:grid;grid-template-rows:auto auto 1fr auto}

/* Topbar */
.topbar{
  position:sticky; top:0; z-index:20;
  display:flex; justify-content:space-between; align-items:center; gap:12px;
  padding:10px 14px; border-bottom:1px solid var(--border); background:var(--panel-solid);
  backdrop-filter:saturate(160%) blur(6px); box-shadow:var(--shadow);
}
.brand-wrap{display:flex;align-items:center;gap:10px}
.bi-box{width:34px;height:34px;border-radius:10px;display:grid;place-items:center;font-weight:900;background:var(--chip);color:var(--chip-fg);border:1px solid var(--border)}
.brand-link{font-weight:800;text-decoration:none;color:var(--fg);border:1px solid var(--border);background:var(--panel-solid);padding:8px 12px;border-radius:12px}
.actions{display:flex;gap:8px}
.iconbtn{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border);background:var(--panel-solid);color:var(--fg);border-radius:12px;padding:10px 12px;cursor:pointer}
.icon{width:20px;height:20px;stroke:currentColor}

/* Hero / search */
.hero{display:grid;place-items:center;padding:26px 12px;border-bottom:1px solid var(--border);background:transparent}
.hero-inner{width:min(1100px,96vw);display:flex;flex-direction:column;gap:10px;align-items:center}
.search-shell{
  width:100%; display:flex; align-items:center; gap:12px; padding:14px;
  border-radius:999px; background:var(--panel); border:1px solid transparent;
  box-shadow:0 14px 40px rgba(2,6,23,.06); backdrop-filter:saturate(180%) blur(var(--glass-blur));
  transition:all .18s ease;
}
.search-shell .s-left{display:flex;align-items:center;gap:12px;padding-left:6px}
.brand-dot{width:10px;height:10px;border-radius:50%;background:var(--accent)}
.search-shell input{flex:1;border:none;background:transparent;outline:none;font-size:18px;padding:6px 4px;color:var(--fg);min-width:120px}
.s-right{display:flex;align-items:center;gap:10px}
.icon-pill{width:44px;height:44px;border-radius:999px;border:1px solid var(--border);background:var(--panel);display:grid;place-items:center;cursor:pointer;transition:transform .12s,box-shadow .18s}
.icon-pill svg{width:20px;height:20px}
.icon-pill:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(0,0,0,.08)}
.search-shell:focus-within{border-color:var(--accent);box-shadow:0 0 0 8px var(--accent-ghost),0 18px 44px rgba(0,0,0,.08)}
.sep{width:1px;height:28px;background:var(--border);border-radius:2px}
.clear-btn{opacity:.95}

/* quota */
.helper{color:var(--muted);font-size:13px}
#quotaWrap{display:flex;align-items:center;gap:10px;width:100%;max-width:1100px}
progress{appearance:none;width:100%;height:8px;border:none;border-radius:999px;overflow:hidden;background:var(--border)}
progress::-webkit-progress-bar{background:var(--border)}
progress::-webkit-progress-value{background:var(--accent)}
progress::-moz-progress-bar{background:var(--accent)}

/* shortcuts strip */
.center{display:grid;place-items:start;padding:22px 16px}
.box{width:min(1100px,96vw);display:flex;flex-direction:column;gap:16px}
.strip{display:flex;gap:10px;padding:10px;border-radius:999px;background:var(--panel);overflow:auto;scroll-snap-type:x mandatory;border:1px dashed var(--border);box-shadow:var(--shadow)}
.shortcut{display:flex;align-items:center;gap:10px;padding:10px 14px;border-radius:999px;background:var(--panel);border:1px solid var(--border);cursor:grab;transition:all .12s}
.shortcut:hover{transform:translateY(-3px);box-shadow:0 10px 28px rgba(2,6,23,.06)}
.shortcut .circle{width:22px;height:22px;border-radius:50%;display:grid;place-items:center;border:1px solid var(--border);background:var(--chip);color:var(--chip-fg)}
.shortcut .title{font-weight:600;white-space:nowrap;max-width:260px;overflow:hidden;text-overflow:ellipsis}
.shortcut .del{position:absolute;top:-6px;right:-6px;width:20px;height:20px;border-radius:50%;border:1px solid var(--border);background:var(--accent-ghost);color:var(--fg);display:flex;align-items:center;justify-content:center;cursor:pointer}

/* drag states */
.drag-ghost{opacity:.6;transform:scale(.96)}
.drag-over{outline:2px dashed var(--accent);outline-offset:4px}

/* results */
.results{display:flex;flex-direction:column;gap:12px;margin-top:8px}
.result{border:1px solid var(--border);background:var(--panel-solid);border-radius:14px;padding:12px 14px;box-shadow:var(--shadow)}
.result-header{display:flex;justify-content:space-between;align-items:center;gap:8px}
.r-title{font-weight:800;margin:0 0 6px}
.r-title a{text-decoration:none;color:var(--fg)}
.r-url{color:var(--muted);font-size:12px;margin-bottom:8px;word-break:break-all}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.chip{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--border);background:var(--panel-solid);border-radius:999px;padding:6px 12px;cursor:pointer;transition:transform .12s,box-shadow .2s}
.chip:hover{box-shadow:0 0 0 3px var(--accent-ghost)}

.footer{text-align:center;color:var(--muted);padding:24px 0 40px;font-size:12px}

/* responsive */
@media (max-width:720px){
  .search-shell{padding:10px}
  .icon-pill{width:40px;height:40px}
  .search-shell input{font-size:16px}
  .strip{padding:8px;gap:8px}
  .shortcut{padding:9px 12px}
  .result{padding:10px}
}
</style>
</head>
<body>
<div class="wrapper">

  <!-- topbar -->
  <div class="topbar">
    <div class="brand-wrap">
      <div class="bi-box" title="Bioinformatics">BI</div>
      <a class="brand-link" href="https://conbio.netlify.app/" target="_blank" rel="noopener">bioinformatics.Sync</a>
    </div>
    <div class="actions">
      <button class="iconbtn" id="todoBtn" title="Open To-Do">
        <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M4 6h16M4 12h16M4 18h9" stroke-width="2" stroke-linecap="round"/></svg>
        <span>To-Do</span>
      </button>
      <button class="iconbtn" id="addBtn" title="Add Shortcut">
        <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M12 5v14M5 12h14" stroke-width="2" stroke-linecap="round"/></svg>
        <span>Add</span>
      </button>
      <button class="iconbtn" id="themeBtn" title="Toggle theme">
        <svg class="icon" viewBox="0 0 24 24" fill="none">
          <mask id="m1"><rect width="24" height="24" fill="#fff"/><circle cx="18" cy="6" r="8" fill="#000"/></mask>
          <g mask="url(#m1)"><circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2" fill="none"/></g>
        </svg>
        <span>Theme</span>
      </button>
    </div>
  </div>

  <!-- hero / search -->
  <div class="hero">
    <div class="hero-inner">
      <div class="search-shell" id="searchShell">
        <div class="s-left">
          <div class="brand-dot" aria-hidden="true"></div>
          <svg class="icon" viewBox="0 0 24 24" fill="none"><circle cx="11" cy="11" r="7.5" stroke-width="2"/><path d="M20 20l-4.5-4.5" stroke-width="2" stroke-linecap="round"/></svg>
        </div>

        <input id="q" type="text" placeholder="Search Google or type a URL…" autocomplete="off" />

        <div class="s-right">
          <button class="icon-pill clear-btn" id="clearBtn" title="Clear">
            <svg viewBox="0 0 24 24" fill="none"><path d="M18 6L6 18M6 6l12 12" stroke-width="2" stroke-linecap="round"/></svg>
          </button>

          <div class="sep" aria-hidden="true"></div>

          <button class="icon-pill" id="micBtn" title="Voice input">
            <svg viewBox="0 0 24 24" fill="none"><path d="M12 4a3 3 0 0 0-3 3v5a3 3 0 0 0 6 0V7a3 3 0 0 0-3-3Z" stroke-width="2"/><path d="M19 11a7 7 0 0 1-14 0" stroke-width="2" stroke-linecap="round"/></svg>
          </button>

          <button class="icon-pill" id="goBtn" title="Search now">
            <svg viewBox="0 0 24 24" fill="none"><path d="M5 12h14" stroke-width="2" stroke-linecap="round"/><path d="M12 5l7 7-7 7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </button>
        </div>
      </div>

      <div id="quotaWrap" style="width:100%;max-width:1100px;display:flex;flex-direction:column;gap:6px;align-items:stretch;margin-top:6px">
        <div class="helper" id="quotaNote">100 Google searches/day → then auto-switches to DuckDuckGo (resets daily).</div>
        <progress id="quotaBar" value="0" max="100" style="width:100%"></progress>
      </div>
    </div>
  </div>

  <!-- main -->
  <div class="center">
    <div class="box">
      <div class="strip" id="strip" aria-label="Shortcuts"></div>

      <div class="results" id="results" aria-live="polite"></div>

      <div class="row" id="pager" style="display:none;gap:8px;margin-top:10px">
        <button class="iconbtn" id="prevBtn" title="Previous results">
          <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M15 19l-7-7 7-7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <span>Prev</span>
        </button>
        <button class="iconbtn" id="nextBtn" title="Next results">
          <span>Next</span>
          <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M9 5l7 7-7 7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
      </div>
    </div>
  </div>

  <div class="footer">Shortcuts are saved locally • Drag to reorder • Theme persists • To-Do opens your link.</div>
</div>

<script>
/* =========================
   CONFIG - replace with your values
   ========================= */
const API_KEY = "YOUR_GOOGLE_API_KEY_HERE"; // << replace
const CX = "YOUR_CX_ID_HERE";              // << replace
const TODO_URL = "https://example.com/todo";
const DAILY_LIMIT = 100;

/* Basic selectors */
const $$ = sel => document.querySelector(sel);
const input = $$('#q');
const resultsEl = $$('#results');
const strip = $$('#strip');
const micBtn = $$('#micBtn');
const clearBtn = $$('#clearBtn');
const goBtn = $$('#goBtn');
const quotaNote = $$('#quotaNote');
const quotaBar = $$('#quotaBar');
const prevBtn = $$('#prevBtn');
const nextBtn = $$('#nextBtn');
const pager = $$('#pager');

/* Theme persistence */
function setTheme(t){
  document.documentElement.setAttribute('data-theme', t);
  localStorage.setItem('study_theme', t);
}
setTheme(localStorage.getItem('study_theme') || 'light');
$$('#themeBtn').addEventListener('click', () => {
  setTheme(document.documentElement.getAttribute('data-theme') === 'light' ? 'dark' : 'light');
});

/* To-Do and Add */
$$('#todoBtn').addEventListener('click', () => window.open(TODO_URL, '_blank'));
$$('#addBtn').addEventListener('click', () => {
  const url = prompt('Paste full URL (https://…) to save as shortcut:');
  if(!url) return;
  let u;
  try { u = new URL(url.trim()); } catch { return alert('Invalid URL'); }
  const name = prompt('Name for this shortcut:', hostnameTitle(u.href)) || hostnameTitle(u.href);
  addShortcut(u.href, (name||'').trim());
});

/* ========== Shortcuts storage + migration ========== */
const LS_KEY = 'study_shortcuts_v8';
const LEGACY_SHORTCUT_KEYS = ['study_shortcuts_v7','study_shortcuts_v6','study_shortcuts_v5','shortcuts','study_shortcuts','study_shortcuts_v4','study_shortcuts_v3'];

function migrateShortcutsIfNeeded(){
  try{
    if(localStorage.getItem(LS_KEY)) return;
    for(const k of LEGACY_SHORTCUT_KEYS){
      const raw = localStorage.getItem(k);
      if(!raw) continue;
      try{
        const parsed = JSON.parse(raw);
        if(Array.isArray(parsed) && parsed.length){
          localStorage.setItem(LS_KEY, JSON.stringify(parsed));
          console.info('Shortcuts migrated from', k);
          return;
        }
      }catch(e){ /* ignore parse errors */ }
    }
  }catch(e){
    console.warn('Shortcut migration error', e);
  }
}
migrateShortcutsIfNeeded();

function loadShortcuts(){ try { return JSON.parse(localStorage.getItem(LS_KEY) || '[]'); } catch { return []; } }
function saveShortcuts(x){ localStorage.setItem(LS_KEY, JSON.stringify(x)); }

function hostnameTitle(url){
  try{
    const { hostname } = new URL(url);
    const base = hostname.replace(/^www\./,'').split('.')[0];
    return base.charAt(0).toUpperCase() + base.slice(1);
  } catch { return url; }
}

/* render strip with drag & drop reorder */
function renderStrip(){
  const list = [{ title: 'To-Do', url: TODO_URL, fixed: true }, ...loadShortcuts()];
  strip.innerHTML = '';
  list.forEach(item => {
    const card = document.createElement('div');
    card.className = 'shortcut';
    card.title = item.url;
    card.dataset.url = item.url;
    card.draggable = !item.fixed;

    card.addEventListener('click', () => window.open(item.url, '_blank'));

    // circle icon
    const circ = document.createElement('div');
    circ.className = 'circle';
    circ.innerHTML = `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" style="stroke:currentColor">
      <path d="M10 14l-2 2a3 3 0 1 1-4-4l2-2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M14 10l2-2a3 3 0 1 1 4 4l-2 2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M8 12l8 0" stroke-width="2" stroke-linecap="round"/>
    </svg>`;

    const t = document.createElement('div');
    t.className = 'title';
    t.textContent = item.title || hostnameTitle(item.url);

    card.appendChild(circ);
    card.appendChild(t);

    if(!item.fixed){
      const del = document.createElement('div');
      del.className = 'del';
      del.title = 'Remove';
      del.innerHTML = `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" style="stroke:currentColor">
        <path d="M6 6l12 12M18 6L6 18" stroke-width="2" stroke-linecap="round"/>
      </svg>`;
      del.addEventListener('click', e => { e.stopPropagation(); removeShortcut(item.url); });
      card.appendChild(del);
    }

    // Drag handlers for reorder
    card.addEventListener('dragstart', e => {
      if(item.fixed){ e.preventDefault(); return; }
      card.classList.add('drag-ghost');
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('text/plain', item.url);
    });
    card.addEventListener('dragend', ()=> card.classList.remove('drag-ghost'));
    card.addEventListener('dragover', e => { e.preventDefault(); card.classList.add('drag-over'); });
    card.addEventListener('dragleave', ()=> card.classList.remove('drag-over'));
    card.addEventListener('drop', e => {
      e.preventDefault(); card.classList.remove('drag-over');
      const src = e.dataTransfer.getData('text/plain'); const tgt = card.dataset.url;
      if(!src || src === tgt) return;
      reorderShortcuts(src, tgt);
    });

    strip.appendChild(card);
  });
}

function addShortcut(url, title){
  const list = loadShortcuts();
  if(list.some(x=>x.url===url)) return alert('Already saved');
  list.push({ title: title || hostnameTitle(url), url });
  saveShortcuts(list);
  renderStrip();
}
function removeShortcut(url){
  saveShortcuts(loadShortcuts().filter(x=>x.url!==url));
  renderStrip();
}
function reorderShortcuts(srcUrl, tgtUrl){
  const list = loadShortcuts();
  const s = list.findIndex(x=>x.url===srcUrl);
  const t = list.findIndex(x=>x.url===tgtUrl);
  if(s<0 || t<0 || s===t) return;
  const [moved] = list.splice(s,1);
  list.splice(t,0,moved);
  saveShortcuts(list);
  renderStrip();
}

/* initial render */
renderStrip();

/* strip drag-scroll (mouse) */
let isDown=false, startX=0, scrollLeft=0;
strip.addEventListener('mousedown', e => { isDown=true; startX = e.pageX - strip.offsetLeft; scrollLeft = strip.scrollLeft; });
strip.addEventListener('mouseleave', ()=> isDown=false);
strip.addEventListener('mouseup', ()=> isDown=false);
strip.addEventListener('mousemove', e => { if(!isDown) return; e.preventDefault(); const x = e.pageX - strip.offsetLeft; strip.scrollLeft = scrollLeft - (x - startX); });

/* ========== Daily quota (stored by day) ========== */
const DAY_KEY = 'study_daily_v3';
function todayStr(){ return new Date().toISOString().slice(0,10); }
function getDaily(){
  let obj;
  try { obj = JSON.parse(localStorage.getItem(DAY_KEY) || '{}'); } catch { obj = {}; }
  if(obj.date !== todayStr()) obj = { date: todayStr(), count: 0 };
  return obj;
}
function saveDaily(o){ localStorage.setItem(DAY_KEY, JSON.stringify(o)); }
function incDaily(){ const o = getDaily(); o.count++; saveDaily(o); return o.count; }
function currentCount(){ return getDaily().count; }
function updateQuotaNote(){
  const used = currentCount();
  const left = Math.max(0, DAILY_LIMIT - used);
  quotaNote.textContent = `${left} Google searches left today → then auto-switches to DuckDuckGo (resets daily).`;
  quotaBar.value = Math.min(100, (used / DAILY_LIMIT) * 100);
}
updateQuotaNote();

/* ========== Search (Google CSE) ========== */
let currentQuery = '', startIndex = 1;

async function search(q, start = 1){
  if(currentCount() >= DAILY_LIMIT){
    const ddg = `https://duckduckgo.com/?q=${encodeURIComponent(q)}`;
    resultsEl.innerHTML = `<div class="helper">Daily Google limit reached. Opening DuckDuckGo…</div>`;
    window.open(ddg, '_blank');
    pager.style.display = 'none';
    return;
  }

  // count this search
  incDaily(); updateQuotaNote();

  resultsEl.innerHTML = '<div class="helper">Searching…</div>';
  try{
    const url = new URL('https://www.googleapis.com/customsearch/v1');
    url.searchParams.set('key', API_KEY);
    url.searchParams.set('cx', CX);
    url.searchParams.set('q', q);
    url.searchParams.set('start', start);
    const res = await fetch(url.toString());
    if(!res.ok) throw new Error('HTTP '+res.status);
    const data = await res.json();
    renderResults(data);
  }catch(err){
    resultsEl.innerHTML = `<div class="helper">Error: ${err.message}. Check API key/CX or quotas.</div>`;
    pager.style.display = 'none';
    console.error(err);
  }
}

function renderResults(data){
  const items = data.items || [];
  resultsEl.innerHTML = '';
  if(items.length === 0){
    resultsEl.innerHTML = '<div class="helper">No results.</div>';
    pager.style.display = 'none';
    return;
  }
  for(const it of items){
    const card = document.createElement('div'); card.className = 'result';

    const header = document.createElement('div'); header.className = 'result-header';

    const titleWrap = document.createElement('div'); titleWrap.className = 'r-title';
    const titleLink = document.createElement('a'); titleLink.href = it.link; titleLink.target = '_blank'; titleLink.rel = 'noopener'; titleLink.textContent = it.title || it.link;
    titleWrap.appendChild(titleLink);

// favicon with fallback
    const icon = document.createElement('img');
    let favicon = '';
    try{ const u = new URL(it.link); favicon = `${u.origin}/favicon.ico`; }catch{}
    icon.src = favicon; icon.alt = ''; icon.width = 20; icon.height = 20; icon.style.borderRadius = '50%';
    icon.addEventListener('error', ()=>{
      const svg = document.createElementNS('http://www.w3.org/2000/svg','svg');
      svg.setAttribute('viewBox','0 0 24 24'); svg.setAttribute('width','20'); svg.setAttribute('height','20');
      svg.style.stroke='currentColor'; svg.style.fill='none';
      svg.innerHTML = '<path d="M12 3a9 9 0 1 1 0 18a9 9 0 0 1 0-18Z" stroke-width="2"/><path d="M3 12h18M12 3c3 3 3 15 0 18M12 3c-3 3-3 15 0 18" stroke-width="2" stroke-linecap="round"/>';
      icon.replaceWith(svg);
    });

    header.appendChild(titleWrap);
    header.appendChild(icon);

    const urlDiv = document.createElement('div'); urlDiv.className = 'r-url'; urlDiv.textContent = it.link;

    const row = document.createElement('div'); row.className = 'row';
    const openBtn = document.createElement('button'); openBtn.className = 'chip';
    openBtn.innerHTML = '<svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M14 3h7v7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M10 14L21 3" stroke-width="2" stroke-linecap="round"/><path d="M21 14v7H3V3h7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><span>Open</span>';
    openBtn.addEventListener('click', ()=> window.open(it.link, '_blank'));

    const saveBtn = document.createElement('button'); saveBtn.className = 'chip';
    saveBtn.innerHTML = '<svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M12 17l-5 3 1-5-4-4 5-.7L12 5l3 4.3 5 .7-4 4 1 5z" stroke-width="2" stroke-linejoin="round"/></svg><span>Save</span>';
    saveBtn.addEventListener('click', ()=>{
      const name = prompt('Name for this shortcut:', it.title || hostnameTitle(it.link)) || (it.title || hostnameTitle(it.link));
      addShortcut(it.link, name);
    });

    row.appendChild(openBtn);
    row.appendChild(saveBtn);

    card.appendChild(header);
    card.appendChild(urlDiv);
    card.appendChild(row);

    resultsEl.appendChild(card);
  }

  // pager
  const nextStart = (data.queries?.nextPage?.[0]?.startIndex) || null;
  const prevStart = (data.queries?.previousPage?.[0]?.startIndex) || null;
  pager.style.display = (nextStart || prevStart) ? 'flex' : 'none';
  nextBtn.disabled = !nextStart; prevBtn.disabled = !prevStart;
  nextBtn.onclick = ()=> { if(!nextStart) return; startIndex = nextStart; search(currentQuery, startIndex); window.scrollTo({top:0,behavior:'smooth'}); };
  prevBtn.onclick = ()=> { if(!prevStart) return; startIndex = prevStart; search(currentQuery, startIndex); window.scrollTo({top:0,behavior:'smooth'}); };
}

/* triggers */
function doSearch(){
  const q = input.value.trim(); if(!q){ input.focus(); return; }
  currentQuery = q; startIndex = 1; search(q, startIndex);
}
goBtn.addEventListener('click', doSearch);
input.addEventListener('keydown', e => { if(e.key === 'Enter') doSearch(); });
clearBtn.addEventListener('click', ()=> { input.value=''; input.focus(); });

/* speech (fill only) */
(function setupSpeech(){
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!SR){ micBtn.title = 'Voice search not supported in this browser'; micBtn.style.display='none'; return; }
  const rec = new SR();
  rec.lang = 'en-US';
  rec.interimResults = false;
  rec.maxAlternatives = 1;
  rec.onstart = ()=> micBtn.classList.add('mic-recording');
  rec.onend = ()=> micBtn.classList.remove('mic-recording');
  rec.onerror = ()=> micBtn.classList.remove('mic-recording');
  rec.onresult = (e) => {
    const text = e.results[0][0].transcript || '';
    if(text) input.value = text; // fill-only
  };
  micBtn.addEventListener('click', ()=> { try{ rec.start(); } catch(e){ console.warn(e); } });
})();

/* small UX: focus input on load */
window.addEventListener('load', ()=>{ setTimeout(()=>input.focus(), 120); });
</script>
</body>
</html>
